{% extends 'base.html' %}
{% load static %}
{% block title %}Status das Chaves{% endblock %}

{% block content %}
<div class="status-container">
    <h2>Status das Chaves</h2>
    <!-- Grid de Chaves -->
    <div class="status-grid">
        {% for status in page_obj %}
        {% include 'componentes/chave_item.html' with status=status %}
        {% empty %}
        <p>Nenhuma chave cadastrada.</p>
        {% endfor %}
    </div>
    <div class="pagination">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="btn-pagination">Anterior</a>
        {% endif %}

        <span>Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="btn-pagination">Próximo</a>
        {% endif %}
    </div>

</div>
    {% if request.user.is_authenticated %}
    <div>
    
        <form action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn-main">Sair</button>
        </form>
    </div>
    {% endif %}
    <form id="logoutForm" action="{% url 'logout' %}" method="post" style="display:none;">
    {% csrf_token %}
</form>

<div id="logout-warning" class="logout-warning" style="display: none;">
    A sessão expira em <span id="contador">5</span> segundos.
</div>

<script>
    let tempoSemAtividade = 0;
    let tempoParaAviso = 5; // 10s sem atividade para começar alerta
    let tempoParaLogout = 10; // 10s após o alerta para deslogar

    let aviso = document.getElementById("logout-warning");
    let numero = document.getElementById("contador");

    aviso.style.display = "none";

    // Reseta o tempo ao detectar atividade
    function resetarInatividade() {
        tempoSemAtividade = 0;
        aviso.style.display = "none";
    }

    // Eventos de atividade
    document.onmousemove = resetarInatividade;
    document.onkeypress = resetarInatividade;
    document.onclick = resetarInatividade;
    document.onscroll = resetarInatividade;

    setInterval(() => {
        tempoSemAtividade++;

        // Se o usuário ficar 10s sem mexer → começa contagem do aviso
        if (tempoSemAtividade >= tempoParaAviso && tempoSemAtividade < tempoParaAviso + tempoParaLogout) {
            aviso.style.display = "block";
            let restante = (tempoParaAviso + tempoParaLogout) - tempoSemAtividade;
            numero.textContent = restante;
        }

        // Se chegar ao final da contagem → desloga automaticamente
        if (tempoSemAtividade >= tempoParaAviso + tempoParaLogout) {
            document.getElementById("logoutForm").submit();
        }

    }, 1000);
</script>

{% endblock %}

